<template>
<div class="page">
	<div class="navbar">
		<div class="navbar-inner sliding">
			<div class="title">MiniQuad - Edit Move</div>
			<div class="right">
				<a href="/moves-edit/" class="link">Done</a>
			</div>
		</div>
	</div>
	<div class="page-content">
		<div class="block-title">Name</div>
		<div class="list">
			<ul>
				<li>
					<div class="item-content item-inner">
						<div class="item-input">
							<input type="text" placeholder="Move name" id="move-name" value="" maxlength="7"/>
							<span style="display: none" id="move-id"></span>
						</div>
					</div>
				</li>
			</ul>
		</div>
		<div class="block-title">Steps</div>
		<div class="list links-list" id="move-steps-list"></div>
		<div class="list" id="move-actions">
			<ul>
				<li><a href="#" class="list-button item-link mq-list-button" @click="onClickAction('duplicate')">Duplicate</a></li>
				<li id="move-delete"><a href="#" class="list-button item-link mq-list-button" style="color: red" @click="onClickAction('delete')">Delete</a></li>
			</ul>
		</div>
	</div>
	<div class="toolbar tabbar toolbar-bottom-md">
		<div class="toolbar-inner sliding">
			<a href="/home/" class="tab-link">
				<i class="icon f7-icons">paper_plane</i>
			</a>
			<a href="#moves" class="tab-link tab-link-active">
				<i class="icon f7-icons">data</i>
			</a>
			<a href="/settings/" class="tab-link">
				<i class="icon f7-icons">filter</i>
			</a>
		</div>
	</div>
</div>
</template>
<script>
return {
    methods: {
		onClickAction: function(actionToDo) {
			var $ = this.$;
			var app = this.$app;
			var moveId = $("#move-id").html();
			sendWSCommand("config:move:" + moveId + ":" + actionToDo);
			var router = this.$router;
			router.navigate('/moves-edit/');
		}
	},

	on: {
		pageInit: function(e, page) {
			var query = page.route.query;
			var $ = this.$;
			var app = this.$app;
			moveId = query.m;
			$("#move-id").html(moveId);
			if (query.cm != undefined) {
				$('#move-name').val("Move-" + moveId);
				var stepsList = "<ul><li><a href='/move-step-edit/?m=" + moveId + "&s=0'><i style='color: grey'>Create step</i></a></li></ul>";
				$("#move-steps-list").html(stepsList);
				$('#move-actions').css('display', 'none');
			} else {
				app.request.json("m" + moveId + ".json", function (data) {
					$('#move-name').val(data.name);
					if (parseInt(moveId) >= 10) {
						$('#move-name').attr('readonly','readonly');
						$('#move-name').css('color', 'grey');
						$('#move-delete').css('display', 'none');
					}
					var stepsList = "<ul>";
					for (var i=0; i<data.steps.length; i++) {
					    stepsList += "<li class='mq-step'><a href='/move-step-edit/?m=" + moveId + "&s=" + i + "' class='item-link item-content mq-step'>" +
									"<table class='mq-step'>" +
										"<tr>" +
											"<td class='mq-step'>" +
												"<table><tr>" +
													"<td style='width: 11%'/>" +
													"<td class='mq-step-left-leg mq-step-front'>" + data.steps[i][0] + "</td>" +
													"<td class='mq-step-left-hip mq-step-front'>" + data.steps[i][1] + "</td>" +
													"<td style='width: 6%'/>" +
													"<td class='mq-step-right-hip mq-step-front'>" + data.steps[i][2] + "</td>" +
													"<td class='mq-step-right-leg mq-step-front'>" + data.steps[i][3] + "</td>" +
													"<td style='width: 11%'></td>" +
												"</tr>" + 
												"<tr style='height: 6px'><td colspan='7'/></tr>" +
												"</table>" +
												"<table><tr>" +
													"<td style='width: 3%'/>" +
													"<td class='mq-step-left-leg'>" + data.steps[i][4] + "</td>" +
													"<td class='mq-step-left-hip'>" + data.steps[i][5] + "</td>" +
													"<td style='width: 10%'/>" +
													"<td class='mq-step-right-hip'>" + data.steps[i][6] + "</td>" +
													"<td class='mq-step-right-leg'>" + data.steps[i][7] + "</td>" +
													"<td style='width: 3%'></td>" +
												"</tr></table>" + 
											"</td>" +
											"<td class='mq-step' style='width: 20%'>" + data.steps[i][8] + "</td>" +
										"</tr>" +
									"</table>" +
								"</a></li>";
					}
					stepsList += "<li><a href='/move-step-edit/?m=" + moveId + "&s=" + data.steps.length + "'><i style='color: grey'>Create step</i></a></li>";
					stepsList += "</ul>";
					$("#move-steps-list").html(stepsList);
				});
			}	
		},
		
        pageBeforeOut: function() {
			var $ = this.$;
			var moveId = $("#move-id").html();
			var moveName = $("#move-name").val();
			if (moveName === '') moveName = "Move-" + moveId;
			sendWSCommand("config:move:" + moveId + ":name:" + moveName);
		},	
	}
}
</script>